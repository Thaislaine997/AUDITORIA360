import{j as e,aA as ce,d as c,e as a,o as _,ay as k,G as o,ar as S,as as T,aD as H,aQ as de,aR as w,O as g,X as ue,z as W,H as B,J as E,K as v,$ as xe,k as d,aG as J,aS as he,aF as me,aH as je,t as K,aI as pe,aJ as ge,aK as ve,aL as Q,aM as i,aN as be,ab as V,I as X,aC as fe,D as L,r as z,s as R,an as O,P as M,R as ye,C as Ce,Q as De}from"./mui-CJAnL3-O.js";import{r}from"./vendor-Cr2nE3UY.js";const U=[{value:"lei",label:"Lei"},{value:"decreto",label:"Decreto"},{value:"cct",label:"Convenção Coletiva (CCT)"},{value:"medida_provisoria",label:"Medida Provisória"},{value:"portaria",label:"Portaria"},{value:"resolucao",label:"Resolução"}],Y=[{value:"pendente",label:"Pendente",color:"default"},{value:"processando",label:"Processando",color:"warning"},{value:"concluido",label:"Concluído",color:"success"},{value:"erro",label:"Erro",color:"error"}],Te=()=>{const[u,Z]=r.useState([]),[P,q]=r.useState(!1),[ee,A]=r.useState(!1),[se,b]=r.useState(!1),[l,I]=r.useState(null),[f,ae]=r.useState(""),[y,te]=r.useState(""),[C,oe]=r.useState(""),[x,re]=r.useState(null),[D,G]=r.useState(!1),[j,le]=r.useState(null),[n,h]=r.useState({titulo:"",tipo_documento:"lei",numero_documento:"",data_publicacao:"",orgao_emissor:""});r.useEffect(()=>{p()},[]),r.useEffect(()=>{p()},[f,y,C]);const p=async()=>{q(!0);try{let s="/api/v1/legislacao?";const t=new URLSearchParams;y&&t.append("tipo_documento",y),C&&t.append("status",C),f&&t.append("search_text",f);const F=await(await fetch(`${s}${t}`)).json();Z(F)}catch(s){console.error("Erro ao carregar documentos:",s)}finally{q(!1)}},ne=async()=>{if(x){G(!0);try{const s=new FormData;s.append("arquivo_pdf",x);const m=await(await fetch("/api/v1/legislacao/extrair-pdf",{method:"POST",body:s})).json();le(m),await p()}catch(s){console.error("Erro no processamento do PDF:",s)}finally{G(!1)}}},ie=async()=>{try{await(await fetch("/api/v1/legislacao",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json(),h({titulo:"",tipo_documento:"lei",numero_documento:"",data_publicacao:"",orgao_emissor:""}),b(!1),await p()}catch(s){console.error("Erro ao criar documento:",s)}},N=s=>{const t=Y.find(F=>F.value===s);if(!t)return e.jsx(_,{label:s,size:"small"});const m={pendente:e.jsx(De,{}),processando:e.jsx(O,{size:16}),concluido:e.jsx(Ce,{}),erro:e.jsx(ye,{})};return e.jsx(_,{label:t.label,color:t.color,size:"small",icon:m[s]})},$=s=>{const t=U.find(m=>m.value===s);return(t==null?void 0:t.label)||s};return e.jsxs(ce,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsxs(c,{sx:{mb:4},children:[e.jsxs(a,{variant:"h4",component:"h1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:2},children:["📚 Gestão de Legislação",e.jsx(_,{label:"Base de Conhecimento Ativa",color:"primary",size:"small",icon:e.jsx(k,{})})]}),e.jsx(a,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Sistema inteligente para transformar arquivos de legislação em conhecimento estruturado que alimenta toda a plataforma AUDITORIA360"}),e.jsxs(o,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{children:e.jsxs(T,{sx:{textAlign:"center",py:2},children:[e.jsx(a,{variant:"h3",color:"primary.main",children:u.length}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total Documentos"})]})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{children:e.jsxs(T,{sx:{textAlign:"center",py:2},children:[e.jsx(a,{variant:"h3",color:"success.main",children:u.filter(s=>s.status_processamento==="concluido").length}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Processados"})]})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{children:e.jsxs(T,{sx:{textAlign:"center",py:2},children:[e.jsx(a,{variant:"h3",color:"warning.main",children:u.filter(s=>s.status_processamento==="processando").length}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Em Processamento"})]})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{children:e.jsxs(T,{sx:{textAlign:"center",py:2},children:[e.jsx(a,{variant:"h3",color:"secondary.main",children:u.filter(s=>s.tipo_documento==="cct").length}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"CCTs"})]})})})]})]}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,md:4,children:e.jsxs(H,{sx:{p:3,sticky:!0,top:20},children:[e.jsxs(a,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{})," Filtros e Ações"]}),e.jsxs(w,{spacing:3,children:[e.jsx(g,{fullWidth:!0,label:"Buscar Documentos",value:f,onChange:s=>ae(s.target.value),placeholder:"Título, número, órgão emissor...",InputProps:{startAdornment:e.jsx(ue,{sx:{mr:1,color:"action.active"}})}}),e.jsxs(W,{fullWidth:!0,children:[e.jsx(B,{children:"Tipo de Documento"}),e.jsxs(E,{value:y,label:"Tipo de Documento",onChange:s=>te(s.target.value),children:[e.jsx(v,{value:"",children:"Todos os Tipos"}),U.map(s=>e.jsx(v,{value:s.value,children:s.label},s.value))]})]}),e.jsxs(W,{fullWidth:!0,children:[e.jsx(B,{children:"Status"}),e.jsxs(E,{value:C,label:"Status",onChange:s=>oe(s.target.value),children:[e.jsx(v,{value:"",children:"Todos os Status"}),Y.map(s=>e.jsx(v,{value:s.value,children:s.label},s.value))]})]}),e.jsx(xe,{}),e.jsxs(w,{spacing:2,children:[e.jsx(d,{variant:"contained",startIcon:e.jsx(J,{}),onClick:()=>A(!0),fullWidth:!0,children:"📤 Upload com IA"}),e.jsx(d,{variant:"outlined",startIcon:e.jsx(he,{}),onClick:()=>b(!0),fullWidth:!0,children:"✏️ Cadastro Manual"}),e.jsx(d,{variant:"text",startIcon:e.jsx(me,{}),onClick:p,fullWidth:!0,disabled:P,children:"🔄 Atualizar Lista"})]})]})]})}),e.jsx(o,{item:!0,xs:12,md:8,children:e.jsxs(H,{sx:{p:3},children:[e.jsxs(a,{variant:"h6",gutterBottom:!0,children:["📋 Documentos Cadastrados (",u.length,")"]}),P&&e.jsx(je,{sx:{mb:2}}),u.length===0&&!P?e.jsxs(K,{severity:"info",sx:{my:3},children:[e.jsx(a,{variant:"subtitle1",children:"Nenhum documento encontrado"}),e.jsx(a,{variant:"body2",children:"Comece fazendo upload de um PDF ou cadastrando um documento manualmente."})]}):e.jsx(pe,{children:e.jsxs(ge,{children:[e.jsx(ve,{children:e.jsxs(Q,{children:[e.jsx(i,{children:"Título"}),e.jsx(i,{children:"Tipo"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Processado"}),e.jsx(i,{children:"Ações"})]})}),e.jsx(be,{children:u.map(s=>e.jsxs(Q,{children:[e.jsx(i,{children:e.jsxs(c,{children:[e.jsx(a,{variant:"subtitle2",children:s.titulo}),s.numero_documento&&e.jsx(a,{variant:"caption",color:"text.secondary",children:s.numero_documento})]})}),e.jsx(i,{children:e.jsx(_,{label:$(s.tipo_documento),size:"small",variant:"outlined"})}),e.jsx(i,{children:N(s.status_processamento)}),e.jsx(i,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.processado_em?new Date(s.processado_em).toLocaleDateString():"-"})}),e.jsx(i,{children:e.jsxs(w,{direction:"row",spacing:1,children:[e.jsx(V,{title:"Ver Detalhes",children:e.jsx(X,{size:"small",onClick:()=>I(s),children:e.jsx(fe,{})})}),s.dados_extraidos&&e.jsx(V,{title:"Dados IA Disponíveis",children:e.jsx(X,{size:"small",color:"primary",children:e.jsx(k,{})})})]})})]},s.id))})]})})]})})]}),e.jsxs(L,{open:ee,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(z,{children:"🤖 Upload Inteligente com IA"}),e.jsxs(R,{children:[e.jsx(a,{variant:"body1",sx:{mb:3},children:"Faça upload do PDF de legislação para que nossa IA extraia automaticamente os dados estruturados."}),e.jsxs(c,{sx:{border:"2px dashed",borderColor:x?"primary.main":"grey.300",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",transition:"all 0.2s","&:hover":{borderColor:"primary.main",backgroundColor:"action.hover"}},onClick:()=>{var s;return(s=document.getElementById("legislation-file-upload"))==null?void 0:s.click()},children:[e.jsx("input",{id:"legislation-file-upload",type:"file",accept:".pdf",hidden:!0,onChange:s=>{var t;return re(((t=s.target.files)==null?void 0:t[0])||null)}}),e.jsx(J,{sx:{fontSize:48,color:"primary.main",mb:2}}),e.jsx(a,{variant:"h6",gutterBottom:!0,children:x?`✓ ${x.name}`:"Selecione um arquivo PDF"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"A IA irá classificar, extrair e estruturar os dados automaticamente"})]}),D&&e.jsxs(c,{sx:{mt:3,textAlign:"center"},children:[e.jsx(O,{}),e.jsxs(a,{variant:"body2",sx:{mt:2},children:["🧠 Processando com IA...",e.jsx("br",{}),"Classificando documento e extraindo dados estruturados"]})]}),j&&e.jsxs(K,{severity:"success",sx:{mt:3},children:[e.jsx(a,{variant:"subtitle1",children:"✅ Processamento Concluído!"}),e.jsxs(a,{variant:"body2",children:["Documento processado com ",(j.confidence_score*100).toFixed(1),"% de confiança em ",j.processamento_tempo_segundos.toFixed(1),"s."]}),j.sugestoes_validacao.length>0&&e.jsxs(c,{sx:{mt:2},children:[e.jsx(a,{variant:"caption",display:"block",children:"💡 Sugestões de validação:"}),j.sugestoes_validacao.map((s,t)=>e.jsxs(a,{variant:"caption",display:"block",sx:{ml:2},children:["• ",s]},t))]})]})]}),e.jsxs(M,{children:[e.jsx(d,{onClick:()=>A(!1),children:"Cancelar"}),e.jsx(d,{variant:"contained",onClick:ne,disabled:!x||D,startIcon:D?e.jsx(O,{size:20}):e.jsx(k,{}),children:D?"Processando...":"🧠 Processar com IA"})]})]}),e.jsxs(L,{open:se,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(z,{children:"✏️ Cadastro Manual de Documento"}),e.jsx(R,{children:e.jsxs(o,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(o,{item:!0,xs:12,children:e.jsx(g,{fullWidth:!0,label:"Título do Documento",value:n.titulo,onChange:s=>h({...n,titulo:s.target.value}),required:!0})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsxs(W,{fullWidth:!0,required:!0,children:[e.jsx(B,{children:"Tipo de Documento"}),e.jsx(E,{value:n.tipo_documento,label:"Tipo de Documento",onChange:s=>h({...n,tipo_documento:s.target.value}),children:U.map(s=>e.jsx(v,{value:s.value,children:s.label},s.value))})]})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,label:"Número/Código",value:n.numero_documento,onChange:s=>h({...n,numero_documento:s.target.value}),placeholder:"Ex: Lei 14.442/2022"})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,label:"Data de Publicação",type:"date",value:n.data_publicacao,onChange:s=>h({...n,data_publicacao:s.target.value}),InputLabelProps:{shrink:!0}})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,label:"Órgão Emissor",value:n.orgao_emissor,onChange:s=>h({...n,orgao_emissor:s.target.value}),placeholder:"Ex: Ministério do Trabalho"})})]})}),e.jsxs(M,{children:[e.jsx(d,{onClick:()=>b(!1),children:"Cancelar"}),e.jsx(d,{variant:"contained",onClick:ie,disabled:!n.titulo,startIcon:e.jsx(Save,{}),children:"Salvar Documento"})]})]}),l&&e.jsxs(L,{open:!!l,onClose:()=>I(null),maxWidth:"lg",fullWidth:!0,children:[e.jsx(z,{children:"📄 Detalhes do Documento"}),e.jsx(R,{children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Informações Básicas:"}),e.jsxs(c,{sx:{mb:2},children:[e.jsx(a,{variant:"h6",children:l.titulo}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:[$(l.tipo_documento),l.numero_documento&&` • ${l.numero_documento}`]}),l.orgao_emissor&&e.jsx(a,{variant:"body2",color:"text.secondary",children:l.orgao_emissor}),l.data_publicacao&&e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Publicado em: ",new Date(l.data_publicacao).toLocaleDateString()]})]}),e.jsx(c,{sx:{mb:2},children:N(l.status_processamento)})]}),e.jsx(o,{item:!0,xs:12,md:6,children:l.dados_extraidos&&e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"📊 Dados Extraídos pela IA:"}),e.jsx(c,{sx:{backgroundColor:"grey.50",p:2,borderRadius:1,maxHeight:400,overflow:"auto"},children:e.jsx(a,{variant:"caption",component:"pre",sx:{fontSize:"0.75rem",whiteSpace:"pre-wrap"},children:JSON.stringify(l.dados_extraidos,null,2)})})]})})]})}),e.jsx(M,{children:e.jsx(d,{onClick:()=>I(null),children:"Fechar"})})]})]})};export{Te as GestaoLegislacaoPage};
//# sourceMappingURL=GestaoLegislacaoPage-RLsGJB2g.js.map
