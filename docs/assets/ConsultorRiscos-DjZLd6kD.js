import{j as e,aA as X,d as i,e as r,G as c,aD as b,z as G,H as V,J,K as E,k as U,an as q,a4 as K,aH as $,t as I,ah as Q,o as f,ar as p,as as j,ab as F,I as _,b0 as Y,b1 as Z,L as ee,l as y,m as v,$ as w,b2 as se,ax as re,b3 as L,b4 as ae,T as te}from"./mui-CJAnL3-O.js";import{r as x}from"./vendor-Cr2nE3UY.js";import{a as M}from"./api-DxBlXaQO.js";import"./utils-Bo08wi2s.js";class g{static async analisarRiscos(t){var n,l,a;try{console.log(`🔮 Triggering risk analysis for company ${t.empresa_id}...`);const d=await M.post("/riscos/analisar",t);return console.log(`✅ Risk analysis completed: Score ${d.data.score_risco}/100`),d.data}catch(d){throw console.error("❌ Risk analysis failed:",d),((n=d.response)==null?void 0:n.status)===404?new Error("Empresa não encontrada. Verifique se o ID está correto."):((l=d.response)==null?void 0:l.status)===500?new Error(`Erro interno na análise: ${((a=d.response.data)==null?void 0:a.detail)||"Erro desconhecido"}`):new Error(`Falha na análise de riscos: ${d.message}`)}}static async obterHistoricoRiscos(t,n=10){var l;try{console.log(`📊 Fetching risk history for company ${t}...`);const a=await M.get(`/riscos/historico/${t}`,{params:{limit:n}});return console.log(`✅ Retrieved ${a.data.length} historical analyses`),a.data}catch(a){throw console.error("❌ Failed to fetch risk history:",a),((l=a.response)==null?void 0:l.status)===404?new Error("Empresa não encontrada."):new Error(`Erro ao buscar histórico: ${a.message}`)}}static getSeverityLabel(t){switch(t){case 5:return"CRÍTICO";case 4:return"ALTO";case 3:return"MÉDIO";case 2:return"BAIXO";case 1:return"INFORMATIVO";default:return"DESCONHECIDO"}}static getRiskLevelColor(t){switch(t){case"CRÍTICO":return"#EF4444";case"ALTO":return"#F59E0B";case"MÉDIO":return"#F59E0B";case"BAIXO":return"#10B981";default:return"#6B7280"}}static getCategoryIcon(t){switch(t){case"TRABALHISTA":return"👷";case"FISCAL":return"📋";case"OPERACIONAL":return"⚙️";case"CONFORMIDADE":return"✅";default:return"⚠️"}}static formatScoreMessage(t,n){return t>=90?`Excelente! Score ${t}/100 - Empresa com práticas exemplares de compliance.`:t>=80?`Muito bom! Score ${t}/100 - Poucos riscos identificados.`:t>=60?`Atenção! Score ${t}/100 - Alguns riscos requerem ação.`:t>=40?`Alerta! Score ${t}/100 - Múltiplos riscos identificados.`:`Crítico! Score ${t}/100 - Ação imediata necessária.`}static calculateTrend(t,n){if(!n)return{trend:"stable",message:"Primeira análise",color:"#6B7280"};const l=t-n;return l>5?{trend:"up",message:`+${l} pontos (melhoria)`,color:"#10B981"}:l<-5?{trend:"down",message:`${l} pontos (deterioração)`,color:"#EF4444"}:{trend:"stable",message:"Estável",color:"#6B7280"}}}const de=()=>{const[m,t]=x.useState(1),[n,l]=x.useState(!1),[a,d]=x.useState(null),[C,R]=x.useState(null),[u,ie]=x.useState(null),[z,S]=x.useState(!1),[A,H]=x.useState({}),[k,P]=x.useState([]);x.useEffect(()=>{D()},[m]);const D=async()=>{try{const s=await g.obterHistoricoRiscos(m,5);P(s)}catch(s){console.warn("Could not load risk history:",s)}},N=async()=>{l(!0),R(null);try{console.log(`🔮 Starting risk analysis for company ${m}`);const s=await g.analisarRiscos({empresa_id:m});d(s),await D(),console.log("✅ Risk analysis completed successfully")}catch(s){console.error("❌ Risk analysis failed:",s),R(s.message||"Erro desconhecido na análise de riscos")}finally{l(!1)}},B=(s,o)=>{H(h=>({...h,[s]:o})),fetch("/api/v1/ai/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recommendation_id:s,feedback_type:o,timestamp:new Date().toISOString(),user_context:{workspace:"risk-analysis",session_id:sessionStorage.getItem("session_id"),empresa_id:m}})}).then(h=>{h.ok&&console.log(`✅ RLHF feedback successfully submitted for risk ${s}: ${o}`)}).catch(h=>{console.warn("⚠️ RLHF feedback submission failed:",h)})},O=s=>s>=4?"#EF4444":s>=3?"#F59E0B":s>=2?"#10B981":"#6B7280",W=()=>{if(!(a!=null&&a.score_anterior))return e.jsx(L,{});switch(g.calculateTrend(a.score_risco,a.score_anterior).trend){case"up":return e.jsx(te,{color:"success"});case"down":return e.jsx(ae,{color:"error"});default:return e.jsx(L,{color:"disabled"})}};return e.jsx(e.Fragment,{children:e.jsxs(X,{maxWidth:"xl",children:[e.jsxs(i,{sx:{mb:4},children:[e.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,children:"🔮 Consultor de Riscos"}),e.jsx(r,{variant:"subtitle1",color:"text.secondary",children:"Análise preditiva inteligente para identificação proativa de riscos trabalhistas, fiscais e operacionais."})]}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,md:8,children:e.jsxs(b,{sx:{p:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"🤖 Análise Inteligente de Riscos"}),e.jsx(i,{sx:{mb:3},children:e.jsxs(G,{fullWidth:!0,children:[e.jsx(V,{children:"Empresa para Análise"}),e.jsxs(J,{value:m,onChange:s=>t(Number(s.target.value)),label:"Empresa para Análise",children:[e.jsx(E,{value:1,children:"Empresa Teste de Riscos S/A"}),e.jsx(E,{value:2,children:"Outra Empresa Ltda (Demo)"}),e.jsx(E,{value:3,children:"Empresa Exemplo ME (Demo)"})]})]})}),e.jsx(U,{variant:"contained",size:"large",startIcon:n?e.jsx(q,{size:20}):e.jsx(K,{}),onClick:N,disabled:n,sx:{mb:3},children:n?"Analisando...":"Executar Nova Análise Completa"}),n&&e.jsxs(i,{sx:{mt:2,mb:3,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(r,{variant:"body2",gutterBottom:!0,children:"🤖 Consultor de Riscos processando análise..."}),(a==null?void 0:a.progresso_analise)&&Object.entries(a.progresso_analise).map(([s,o])=>e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsxs(r,{variant:"caption",sx:{minWidth:200},children:[s.replace(/_/g," "),":"]}),e.jsx(r,{variant:"caption",color:"success.main",children:o})]},s)),e.jsx($,{sx:{mt:2}})]}),C&&e.jsx(I,{severity:"error",sx:{mb:3},children:e.jsxs(r,{variant:"body2",children:["❌ Erro na análise: ",C]})}),a&&e.jsxs(b,{sx:{mt:3,p:3},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Q,{sx:{mr:1}}),e.jsxs(r,{variant:"h6",children:["📊 Relatório: ",a.empresa_nome]})]}),e.jsx(i,{sx:{mb:3,p:2,bgcolor:"primary.light",borderRadius:2},children:e.jsxs(c,{container:!0,spacing:2,alignItems:"center",children:[e.jsxs(c,{item:!0,xs:12,md:4,children:[e.jsxs(r,{variant:"h3",color:"primary",sx:{fontWeight:"bold"},children:[a.score_risco,"/100"]}),e.jsx(r,{variant:"h6",color:"primary",children:"Score de Risco"}),e.jsx(f,{label:a.nivel_risco,color:a.nivel_risco==="BAIXO"?"success":a.nivel_risco==="MÉDIO"?"warning":"error",size:"large",sx:{mt:1}})]}),e.jsxs(c,{item:!0,xs:12,md:4,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:g.formatScoreMessage(a.score_risco,a.nivel_risco)}),a.score_anterior&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",mt:1},children:[W(),e.jsx(r,{variant:"caption",sx:{ml:1},children:g.calculateTrend(a.score_risco,a.score_anterior).message})]})]}),e.jsxs(c,{item:!0,xs:12,md:4,children:[e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Última análise: ",new Date(a.data_analise).toLocaleDateString("pt-BR")]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Total de riscos: ",a.total_riscos]})]})]})}),e.jsxs(c,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(c,{item:!0,xs:3,children:e.jsx(p,{sx:{textAlign:"center",bgcolor:"error.light"},children:e.jsxs(j,{children:[e.jsx(r,{variant:"h4",color:"error",children:a.riscos_criticos}),e.jsx(r,{variant:"body2",children:"Críticos"})]})})}),e.jsx(c,{item:!0,xs:3,children:e.jsx(p,{sx:{textAlign:"center",bgcolor:"warning.light"},children:e.jsxs(j,{children:[e.jsx(r,{variant:"h4",color:"warning.dark",children:a.riscos_altos}),e.jsx(r,{variant:"body2",children:"Altos"})]})})}),e.jsx(c,{item:!0,xs:3,children:e.jsx(p,{sx:{textAlign:"center",bgcolor:"info.light"},children:e.jsxs(j,{children:[e.jsx(r,{variant:"h4",color:"info.dark",children:a.riscos_medios}),e.jsx(r,{variant:"body2",children:"Médios"})]})})}),e.jsx(c,{item:!0,xs:3,children:e.jsx(p,{sx:{textAlign:"center",bgcolor:"success.light"},children:e.jsxs(j,{children:[e.jsx(r,{variant:"h4",color:"success.dark",children:a.riscos_baixos}),e.jsx(r,{variant:"body2",children:"Baixos"})]})})})]}),e.jsx(r,{variant:"h6",gutterBottom:!0,children:"🔍 Riscos Detalhados"}),a.riscos_encontrados.map((s,o)=>e.jsx(p,{sx:{mb:2,border:`2px solid ${O(s.severidade)}`},children:e.jsx(j,{children:e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsxs(i,{sx:{flex:1},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"body2",sx:{mr:1},children:g.getCategoryIcon(s.categoria)}),e.jsx(f,{label:s.categoria,size:"small",color:s.categoria==="CONFORMIDADE"?"success":"default"}),e.jsx(f,{label:`Severidade: ${s.severidade}/5`,size:"small",sx:{ml:1,bgcolor:O(s.severidade),color:"white"}})]}),e.jsx(r,{variant:"h6",gutterBottom:!0,children:s.tipo_risco}),e.jsxs(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:[e.jsx("strong",{children:"Descrição:"})," ",s.descricao]}),e.jsxs(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:[e.jsx("strong",{children:"Evidência:"})," ",s.evidencia]}),e.jsxs(r,{variant:"body2",color:"error",paragraph:!0,children:[e.jsx("strong",{children:"Impacto Potencial:"})," ",s.impacto_potencial]}),e.jsxs(r,{variant:"body2",color:"primary",paragraph:!0,children:[e.jsx("strong",{children:"Plano de Ação:"})," ",s.plano_acao]})]}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",ml:2},children:[e.jsx(r,{variant:"caption",sx:{mb:1},children:"Esta análise foi útil?"}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(F,{title:"Análise útil",children:e.jsx(_,{size:"small",color:A[o]==="positive"?"success":"default",onClick:()=>B(o,"positive"),children:e.jsx(Y,{})})}),e.jsx(F,{title:"Análise não útil",children:e.jsx(_,{size:"small",color:A[o]==="negative"?"error":"default",onClick:()=>B(o,"negative"),children:e.jsx(Z,{})})})]}),A[o]&&e.jsx(r,{variant:"caption",sx:{mt:1,color:"text.secondary"},children:"Obrigado pelo feedback!"})]})]})})},o))]})]})}),e.jsxs(c,{item:!0,xs:12,md:4,children:[e.jsxs(b,{sx:{p:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"📈 Histórico de Análises"}),k.length>0?k.map((s,o)=>e.jsx(p,{sx:{mb:2},children:e.jsxs(j,{sx:{p:2,"&:last-child":{pb:2}},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:new Date(s.data_analise).toLocaleDateString("pt-BR")}),e.jsxs(r,{variant:"h6",color:"primary",children:[s.score_risco,"/100"]})]}),e.jsx(f,{label:s.relatorio_resumo.nivel_risco,size:"small",color:s.relatorio_resumo.nivel_risco==="BAIXO"?"success":s.relatorio_resumo.nivel_risco==="MÉDIO"?"warning":"error",sx:{mb:1}}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[s.relatorio_resumo.total_riscos," riscos identificados"]}),e.jsx(i,{sx:{display:"flex",gap:.5,flexWrap:"wrap",mt:1},children:Object.entries(s.relatorio_resumo.categorias).map(([h,T])=>T>0&&e.jsx(f,{label:`${h}: ${T}`,size:"small",variant:"outlined",sx:{fontSize:"0.6rem",height:"16px"}},h))})]})},s.id)):e.jsx(I,{severity:"info",children:e.jsx(r,{variant:"body2",children:"Nenhuma análise anterior encontrada. Execute uma análise para começar o histórico."})})]}),e.jsxs(b,{sx:{p:3,mt:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"ℹ️ Como Funciona"}),e.jsxs(ee,{dense:!0,children:[e.jsx(y,{children:e.jsx(v,{primary:"1. Agregação de Dados",secondary:"Coleta dados dos últimos 12-24 meses da empresa"})}),e.jsx(w,{}),e.jsx(y,{children:e.jsx(v,{primary:"2. Análise de Conformidade",secondary:"Verifica conformidade trabalhista e fiscal"})}),e.jsx(w,{}),e.jsx(y,{children:e.jsx(v,{primary:"3. Detecção de Padrões",secondary:"IA identifica anomalias e riscos ocultos"})}),e.jsx(w,{}),e.jsx(y,{children:e.jsx(v,{primary:"4. Recomendações",secondary:"Gera planos de ação específicos"})})]})]})]})]}),e.jsx(se,{open:z,onClose:()=>S(!1),"aria-labelledby":"drill-down-modal",children:e.jsxs(i,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:600,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,maxHeight:"80vh",overflow:"auto"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(r,{variant:"h6",component:"h2",children:["📊 Análise Detalhada: ",u==null?void 0:u.factor]}),e.jsx(_,{onClick:()=>S(!1),children:e.jsx(re,{})})]}),u&&e.jsxs(i,{children:[e.jsx(I,{severity:"info",sx:{mb:2},children:e.jsxs(r,{variant:"body2",children:['Dados históricos dos últimos 5 meses para o fator de risco "',u.factor,'"']})}),e.jsxs(b,{sx:{p:2,bgcolor:"grey.50"},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Tendência Temporal"}),u.historicalData.map((s,o)=>e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsxs(r,{variant:"body2",sx:{minWidth:40},children:[s.month,":"]}),e.jsx($,{variant:"determinate",value:s.value/35*100,sx:{flex:1,ml:1,mr:1}}),e.jsx(r,{variant:"body2",sx:{minWidth:30},children:s.value})]},o))]}),e.jsxs(i,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Recomendações Específicas"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"• Monitorar variações acima de 20% em relação ao mês anterior • Revisar políticas internas relacionadas a este fator • Considerar automação para reduzir erros manuais"})]})]})]})})]})})};export{de as default};
//# sourceMappingURL=ConsultorRiscos-DjZLd6kD.js.map
