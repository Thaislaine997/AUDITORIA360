import{j as e,aA as ce,d as o,e as a,o as h,aP as W,G as i,ar as m,as as j,aD as z,aQ as de,aR as N,O as xe,X as ue,z as V,H as U,J as $,K as p,$ as he,k as c,aS as me,aG as M,aF as je,aH as pe,t as O,ah as q,aT as G,D as H,r as J,s as Q,an as K,P as X,L as ge,l as I,Z as T,m as w,a2 as fe,aC as ve,R as Ce,W as ye,C as be,Q as Se}from"./mui-CJAnL3-O.js";import{r}from"./vendor-Cr2nE3UY.js";const Te=()=>{const[_,Y]=r.useState([]),[F,Z]=r.useState([]),[l,ee]=r.useState(null),[y,P]=r.useState(!1),[g,se]=r.useState(""),[f,ae]=r.useState(""),[v,te]=r.useState("todas"),[De,re]=r.useState(!1),[ie,b]=r.useState(!1),[n,S]=r.useState(null),[d,ne]=r.useState(null),[C,k]=r.useState(!1),[B,oe]=r.useState(null);r.useEffect(()=>{D()},[]),r.useEffect(()=>{E()},[g,f,v]);const D=async()=>{P(!0);try{const t=await(await fetch("/api/v1/sindicatos")).json();Z(t),await E()}catch(s){console.error("Erro ao carregar dados:",s)}finally{P(!1)}},E=async()=>{try{let s="/api/v1/cct?";const t=new URLSearchParams;f&&t.append("sindicato_id",f.toString()),g&&t.append("search_text",g),v!=="todas"&&t.append("vigente",v==="ativas"?"true":"false");const u=await(await fetch(`${s}${t}`)).json();Y(u.ccts),ee(u)}catch(s){console.error("Erro ao carregar CCTs:",s)}},le=async()=>{if(d){k(!0);try{const s=new FormData;s.append("arquivo_pdf",d);const x=await(await fetch("/api/v1/legislacao/extrair-pdf",{method:"POST",body:s})).json();oe(x),await D()}catch(s){console.error("Erro no processamento do PDF:",s)}finally{k(!1)}}},L=s=>{const t=new Date,x=new Date(s.vigencia_inicio),u=new Date(s.vigencia_fim),R=new Date;return R.setDate(t.getDate()+30),u<t?e.jsx(h,{label:"Expirado",color:"error",size:"small",icon:e.jsx(Ce,{})}):u<=R?e.jsx(h,{label:"Expirando em Breve",color:"warning",size:"small",icon:e.jsx(ye,{})}):x<=t&&u>=t?e.jsx(h,{label:"Ativo",color:"success",size:"small",icon:e.jsx(be,{})}):e.jsx(h,{label:"Futuro",color:"info",size:"small",icon:e.jsx(Se,{})})},A=s=>{const t=F.find(x=>x.id===s);return(t==null?void 0:t.nome_sindicato)||"Sindicato nÃ£o encontrado"};return e.jsxs(ce,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsxs(o,{sx:{mb:4},children:[e.jsxs(a,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:2},children:["ðŸ“‹ CCT - ConvenÃ§Ãµes Coletivas de Trabalho",e.jsx(h,{label:"Biblioteca Digital Inteligente",color:"primary",size:"small",icon:e.jsx(W,{})})]}),l&&e.jsxs(i,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{children:e.jsxs(j,{sx:{textAlign:"center",py:2},children:[e.jsx(a,{variant:"h3",color:"primary.main",children:l.total}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total de CCTs"})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{children:e.jsxs(j,{sx:{textAlign:"center",py:2},children:[e.jsx(a,{variant:"h3",color:"success.main",children:l.ativas}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Ativas"})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{children:e.jsxs(j,{sx:{textAlign:"center",py:2},children:[e.jsx(a,{variant:"h3",color:"warning.main",children:l.expirando_30_dias}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Expirando em 30 dias"})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{children:e.jsxs(j,{sx:{textAlign:"center",py:2},children:[e.jsx(a,{variant:"h3",color:"error.main",children:l.expiradas}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Expiradas"})]})})})]})]}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,md:4,children:e.jsxs(z,{sx:{p:3,sticky:!0,top:20},children:[e.jsxs(a,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{})," Filtros Poderosos"]}),e.jsxs(N,{spacing:3,children:[e.jsx(xe,{fullWidth:!0,label:"Busca Inteligente",value:g,onChange:s=>se(s.target.value),placeholder:"Nome do sindicato, registro MTE...",InputProps:{startAdornment:e.jsx(ue,{sx:{mr:1,color:"action.active"}})}}),e.jsxs(V,{fullWidth:!0,children:[e.jsx(U,{children:"Filtrar por Sindicato"}),e.jsxs($,{value:f,label:"Filtrar por Sindicato",onChange:s=>ae(s.target.value),children:[e.jsx(p,{value:"",children:"Todos os Sindicatos"}),F.map(s=>e.jsx(p,{value:s.id,children:s.nome_sindicato},s.id))]})]}),e.jsxs(V,{fullWidth:!0,children:[e.jsx(U,{children:"Filtrar por VigÃªncia"}),e.jsxs($,{value:v,label:"Filtrar por VigÃªncia",onChange:s=>te(s.target.value),children:[e.jsx(p,{value:"todas",children:"Todas as CCTs"}),e.jsx(p,{value:"ativas",children:"Apenas Ativas"}),e.jsx(p,{value:"expiradas",children:"Apenas Expiradas"})]})]}),e.jsx(he,{}),e.jsxs(N,{spacing:2,children:[e.jsx(c,{variant:"contained",startIcon:e.jsx(me,{}),onClick:()=>re(!0),fullWidth:!0,children:"Cadastrar Nova CCT"}),e.jsx(c,{variant:"outlined",startIcon:e.jsx(M,{}),onClick:()=>b(!0),fullWidth:!0,color:"secondary",children:"Upload com IA"}),e.jsx(c,{variant:"text",startIcon:e.jsx(je,{}),onClick:D,fullWidth:!0,disabled:y,children:"Atualizar Dados"})]})]})]})}),e.jsx(i,{item:!0,xs:12,md:8,children:e.jsxs(z,{sx:{p:3},children:[e.jsxs(a,{variant:"h6",gutterBottom:!0,children:["ðŸ“‹ Resultados (",(l==null?void 0:l.total)||0," CCTs encontradas)"]}),y&&e.jsx(pe,{sx:{mb:2}}),_.length===0&&!y?e.jsxs(O,{severity:"info",sx:{my:3},children:[e.jsx(a,{variant:"subtitle1",children:"Nenhuma CCT encontrada"}),e.jsx(a,{variant:"body2",children:"Comece cadastrando um novo sindicato e sua CCT, ou faÃ§a upload de um PDF para anÃ¡lise automÃ¡tica."})]}):e.jsx(i,{container:!0,spacing:2,children:_.map(s=>e.jsx(i,{item:!0,xs:12,children:e.jsx(m,{sx:{cursor:"pointer",transition:"all 0.2s","&:hover":{boxShadow:3,transform:"translateY(-2px)"}},onClick:()=>S(s),children:e.jsxs(j,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsxs(o,{sx:{flexGrow:1},children:[e.jsx(a,{variant:"h6",color:"primary",gutterBottom:!0,children:A(s.sindicato_id)}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:[e.jsx(q,{fontSize:"small",sx:{mr:1,verticalAlign:"middle"}}),"Registro MTE: ",s.numero_registro_mte||"NÃ£o informado"]})]}),L(s)]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(G,{fontSize:"small",color:"action"}),e.jsxs(a,{variant:"body2",children:["VigÃªncia: ",new Date(s.vigencia_inicio).toLocaleDateString()," atÃ© ",new Date(s.vigencia_fim).toLocaleDateString()]})]}),s.dados_cct&&e.jsx(o,{sx:{mt:2},children:e.jsx(a,{variant:"caption",color:"text.secondary",children:"ðŸ“Š Dados estruturados disponÃ­veis â€¢ Processado pela IA"})})]})})},s.id))})]})})]}),e.jsxs(H,{open:ie,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(J,{children:"ðŸ¤– Cadastro Assistido por IA"}),e.jsxs(Q,{children:[e.jsx(a,{variant:"body1",sx:{mb:3},children:"Arraste o PDF da CCT ou da Lei para que nossa IA extraia os dados automaticamente."}),e.jsxs(o,{sx:{border:"2px dashed",borderColor:d?"primary.main":"grey.300",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",transition:"all 0.2s","&:hover":{borderColor:"primary.main",backgroundColor:"action.hover"}},onClick:()=>{var s;return(s=document.getElementById("file-upload"))==null?void 0:s.click()},children:[e.jsx("input",{id:"file-upload",type:"file",accept:".pdf",hidden:!0,onChange:s=>{var t;return ne(((t=s.target.files)==null?void 0:t[0])||null)}}),e.jsx(M,{sx:{fontSize:48,color:"primary.main",mb:2}}),e.jsx(a,{variant:"h6",gutterBottom:!0,children:d?`âœ“ ${d.name}`:"Clique ou arraste um PDF aqui"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Formatos aceitos: PDF (mÃ¡ximo 50MB)"})]}),C&&e.jsxs(o,{sx:{mt:3,textAlign:"center"},children:[e.jsx(K,{}),e.jsx(a,{variant:"body2",sx:{mt:2},children:"ðŸ§  Processando com IA... Analisando documento e extraindo dados estruturados"})]}),B&&e.jsxs(O,{severity:"success",sx:{mt:3},children:[e.jsx(a,{variant:"subtitle1",children:"âœ“ Processamento ConcluÃ­do!"}),e.jsxs(a,{variant:"body2",children:["Documento processado com ",(B.confidence_score*100).toFixed(1),"% de confianÃ§a. Os dados extraÃ­dos estÃ£o prontos para validaÃ§Ã£o."]})]})]}),e.jsxs(X,{children:[e.jsx(c,{onClick:()=>b(!1),children:"Cancelar"}),e.jsx(c,{variant:"contained",onClick:le,disabled:!d||C,startIcon:C?e.jsx(K,{size:20}):e.jsx(W,{}),children:C?"Processando...":"Processar com IA"})]})]}),n&&e.jsxs(H,{open:!!n,onClose:()=>S(null),maxWidth:"lg",fullWidth:!0,children:[e.jsxs(J,{children:["ðŸ“‹ Detalhes da CCT - ",A(n.sindicato_id)]}),e.jsx(Q,{children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{item:!0,xs:12,md:6,children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"InformaÃ§Ãµes BÃ¡sicas:"}),e.jsxs(ge,{dense:!0,children:[e.jsxs(I,{children:[e.jsx(T,{children:e.jsx(q,{})}),e.jsx(w,{primary:"Sindicato",secondary:A(n.sindicato_id)})]}),e.jsxs(I,{children:[e.jsx(T,{children:e.jsx(fe,{})}),e.jsx(w,{primary:"Registro MTE",secondary:n.numero_registro_mte||"NÃ£o informado"})]}),e.jsxs(I,{children:[e.jsx(T,{children:e.jsx(G,{})}),e.jsx(w,{primary:"VigÃªncia",secondary:`${new Date(n.vigencia_inicio).toLocaleDateString()} - ${new Date(n.vigencia_fim).toLocaleDateString()}`})]})]})]}),e.jsxs(i,{item:!0,xs:12,md:6,children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Status:"}),e.jsx(o,{sx:{mb:2},children:L(n)}),n.dados_cct&&e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Dados Estruturados (IA):"}),e.jsx(o,{sx:{backgroundColor:"grey.50",p:2,borderRadius:1},children:e.jsx(a,{variant:"caption",component:"pre",sx:{fontSize:"0.75rem"},children:JSON.stringify(n.dados_cct,null,2)})})]})]})]})}),e.jsxs(X,{children:[e.jsx(c,{onClick:()=>S(null),children:"Fechar"}),n.link_documento_oficial&&e.jsx(c,{variant:"contained",startIcon:e.jsx(ve,{}),href:n.link_documento_oficial,target:"_blank",children:"Ver Documento Oficial"})]})]})]})};export{Te as default};
//# sourceMappingURL=CCTPage-BfMF_KHQ.js.map
